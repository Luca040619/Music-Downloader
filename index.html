<!DOCTYPE html>
<html>
    <head>
        <title>Music Downloader</title>
        <meta charset="UTF-8">
        <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="css/index.css" rel="stylesheet" type="text/css">
    </head>
    <body>
        <h1>Music Downloader</h1>
        <section class="section-main">
            <div class="section-downloader">
                <form id="dataForm">
                    <div class="input-group mb-3">
                        <span class="input-group-text"
                            id="basic-addon1"><svg
                                xmlns="http://www.w3.org/2000/svg" width="16"
                                height="16" fill="currentColor"
                                class="bi bi-link" viewBox="0 0 16 16">
                                <path
                                    d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9q-.13 0-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z" />
                                <path
                                    d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4 4 0 0 1-.82 1H12a3 3 0 1 0 0-6z" />
                            </svg>
                        </span>
                        <input type="text" class="form-control" id="inputField"
                            placeholder="Inserisci l'URL della canzone o playlist"
                            aria-label="Username"
                            aria-describedby="basic-addon1">
                    </div>
                    <button type="submit"
                        class="btn btn-primary w-100" id="scarica">Scarica</button>
                </form>
                <p id="error" style="display: none;"></p>
                <div class="w-100" id="status-container" style="display: none;">
                    <div class="down-header w-100">
                        <p id="songTitle">Caricamento...</p>
                        <p id="playlistProgress"
                            style="display: none;">Progresso
                            Playlist</p>
                    </div>

                    <div id="progressBarContainer">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>

                <div class="spinner-border text-primary" role="status"
                    id="spinner" style="display: none;">
                    <span class="visually-hidden">Loading...</span>
                </div>

                <div class="down-header w-100 gap-10">
                    <button class="btn btn-secondary down-header"
                        id="openFolder">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink"
                            version="1.1"
                            width="25" height="25" viewBox="0 0 256 256"
                            xml:space="preserve">

                            <defs>
                            </defs>
                            <g
                                style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;"
                                transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)">
                                <path
                                    d="M 73.538 35.162 l -52.548 1.952 c -1.739 0 -2.753 0.651 -3.232 2.323 L 6.85 76.754 c -0.451 1.586 -2.613 2.328 -4.117 2.328 h 0 C 1.23 79.082 0 77.852 0 76.349 l 0 -10.458 V 23.046 v -2.047 v -6.273 c 0 -2.103 1.705 -3.808 3.808 -3.808 h 27.056 c 1.01 0 1.978 0.401 2.692 1.115 l 7.85 7.85 c 0.714 0.714 1.683 1.115 2.692 1.115 H 69.73 c 2.103 0 3.808 1.705 3.808 3.808 v 1.301 C 73.538 26.106 73.538 35.162 73.538 35.162 z"
                                    style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(224,173,49); fill-rule: nonzero; opacity: 1;"
                                    transform=" matrix(1 0 0 1 0 0) "
                                    stroke-linecap="round" />
                                <path
                                    d="M 2.733 79.082 L 2.733 79.082 c 1.503 0 2.282 -1.147 2.733 -2.733 l 10.996 -38.362 c 0.479 -1.672 2.008 -2.824 3.748 -2.824 h 67.379 c 1.609 0 2.765 1.546 2.311 3.09 L 79.004 75.279 c -0.492 1.751 -1.571 3.818 -3.803 3.803 C 75.201 79.082 2.733 79.082 2.733 79.082 z"
                                    style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,200,67); fill-rule: nonzero; opacity: 1;"
                                    transform=" matrix(1 0 0 1 0 0) "
                                    stroke-linecap="round" />
                            </g>
                        </svg>
                        &nbsp;&nbsp;Visualizza downloads
                    </button>
                    <button class="btn btn-secondary down-header"
                        id="selectFolder">
                        <svg xmlns="http://www.w3.org/2000/svg"
                            xmlns:xlink="http://www.w3.org/1999/xlink"
                            version="1.1"
                            width="25" height="25" viewBox="0 0 256 256"
                            xml:space="preserve">

                            <defs>
                            </defs>
                            <g
                                style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;"
                                transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)">
                                <path
                                    d="M 73.538 35.162 l -52.548 1.952 c -1.739 0 -2.753 0.651 -3.232 2.323 L 6.85 76.754 c -0.451 1.586 -2.613 2.328 -4.117 2.328 h 0 C 1.23 79.082 0 77.852 0 76.349 l 0 -10.458 V 23.046 v -2.047 v -6.273 c 0 -2.103 1.705 -3.808 3.808 -3.808 h 27.056 c 1.01 0 1.978 0.401 2.692 1.115 l 7.85 7.85 c 0.714 0.714 1.683 1.115 2.692 1.115 H 69.73 c 2.103 0 3.808 1.705 3.808 3.808 v 1.301 C 73.538 26.106 73.538 35.162 73.538 35.162 z"
                                    style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(224,173,49); fill-rule: nonzero; opacity: 1;"
                                    transform=" matrix(1 0 0 1 0 0) "
                                    stroke-linecap="round" />
                                <path
                                    d="M 2.733 79.082 L 2.733 79.082 c 1.503 0 2.282 -1.147 2.733 -2.733 l 10.996 -38.362 c 0.479 -1.672 2.008 -2.824 3.748 -2.824 h 67.379 c 1.609 0 2.765 1.546 2.311 3.09 L 79.004 75.279 c -0.492 1.751 -1.571 3.818 -3.803 3.803 C 75.201 79.082 2.733 79.082 2.733 79.082 z"
                                    style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,200,67); fill-rule: nonzero; opacity: 1;"
                                    transform=" matrix(1 0 0 1 0 0) "
                                    stroke-linecap="round" />
                            </g>
                        </svg>
                        &nbsp;&nbsp;Cambia percorso
                    </button>

                    <button id="stopDownload" class="btn btn-danger" disabled>Stop</button>
                </div>
            </div>
        </section>
        <div class="footer">
            <p>Â© 2024 Luca Porzio</p>
        </div>

        <script src="renderer.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const { ipcRenderer } = require('electron');

                document.getElementById('selectFolder').addEventListener('click', async () => {
                    const newPath = await ipcRenderer.invoke('select-directory');
                    if (newPath) {
                        alert('Cartella salvata: ' + newPath);
                    }
                });

                document.getElementById('openFolder').addEventListener('click', () => {
                    ipcRenderer.invoke('open-directory');
                });

                document.getElementById('stopDownload').addEventListener('click', () => {
                    ipcRenderer.invoke('stop-download');
                });

                ipcRenderer.on('error-message', (event, message) => {
                    //alert(message);
                });
                
                ipcRenderer.on('download-stopped', (event, message) => {
                    document.getElementById('status-container').style ='display: none';
                    document.getElementById('progressBar').style.width = '0%';
                    document.getElementById('progressBar').textContent = '';
                    document.getElementById('playlistProgress').style.display = 'none';
                    document.getElementById('spinner').style.display = 'none';
                });
            });
        </script>
    </body>
</html>
